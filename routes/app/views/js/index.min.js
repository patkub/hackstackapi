"use strict";

$(function () {
  window.hackstack = window.hackstack || {};

  (function (hackstack) {
    // create the components
    var navbar = new HackStackNavBar("home");
    var navtabs = new HackStackNavTabs("movies");
    var footer = new HackStackFooter(); // render the components

    $("#navbar").append(navbar.render());
    $("#navtabs").append(navtabs.render());
    $("#footer").append(footer.render());
    $.getJSON(window.hackstack.API_SERVER + "movies", function (data) {
      // movies per row
      var NUM_CHUNKS = 3;

      var _loop = function _loop(i) {
        var temparray = data.slice(i, i + NUM_CHUNKS); // make array of chunks

        var movies = [];
        $.each(temparray, function (_, val) {
          var smallRentalItem = new HackStackRentalItemSmall("movie", val.itemID, val.title, val.year, val.description, val.imagePath, "/rentMovie/");
          movies.push(smallRentalItem.render());
        }); // make a card deck out of current movies
        // aligns empty spaces evenly

        var cardDeck = new HackStackCardDeck(movies, NUM_CHUNKS);
        document.getElementById("movies").append(cardDeck.render());
      };

      for (var i = 0; i < data.length; i += NUM_CHUNKS) {
        _loop(i);
      }

      $(data).each(function (_, val) {
        // show rental status overlay
        if (hackstack.overlayStates.indexOf(val.rentalStatus) >= 0) {
          hackstack.showRentalItemSmallOverlay(val.itemID, val.rentalStatus);
        }
      });
    });
  })(window.hackstack);
});
